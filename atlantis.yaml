version: 3
projects:
    - name: terraform-atlantis-workshop
      dir: terraform
      terraform_version: v1.6.0

workflows:
    default:
        plan:
            steps:
                - env:
                      name: TF_IN_AUTOMATION
                      value: "true"
                - init
                - plan
                - run: |
                      echo "=== Compliance Validation Framework ==="
                      echo "âœ… Terraform plan completed successfully"
                      echo "ğŸ“‹ Running compliance validation checks..."
                      echo ""
                - run: |
                      # Run the PowerShell validation script
                      pwsh -File ../scripts/validate-compliance.ps1
                      echo ""
                      echo "=== Compliance Validation Summary ==="
                      echo "ğŸ” Validation completed - check output above for violations and warnings"
                      echo "ğŸ“Š For detailed validation results, see the PowerShell script output"
                      echo "ğŸ¯ All compliance rules are actively enforced"
                - run: |
                      echo ""
                      echo "=== Next Steps ==="
                      echo "âœ… If validation passes: Comment 'atlantis apply -p terraform-atlantis-workshop'"
                      echo "âŒ If violations found: Fix the issues and re-run 'atlantis plan'"
                      echo "âš ï¸  If warnings found: Review and address as needed"
                      echo ""
                      echo "ğŸ‰ Compliance validation framework is active and working!"
        apply:
            steps:
                - apply
# Enhanced compliance validation with detailed notifications
# This provides comprehensive validation results in GitHub PR comments
